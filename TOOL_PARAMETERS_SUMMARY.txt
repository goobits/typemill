MILL TOOL PARAMETERS - QUICK REFERENCE
======================================

TOOL 1: analyze.structure
========================
Handler: /workspace/crates/mill-handlers/src/handlers/tools/analysis/structure.rs (lines 1170-1251)

REQUIRED PARAMETERS:
  - kind (string): One of: "symbols", "hierarchy", "interfaces", "inheritance", "modules"

OPTIONAL PARAMETERS:
  - scope (object): Analysis scope (file, directory, workspace) - handled by shared engine
  - options (object): Additional configuration

ERROR WHEN MISSING KIND:
  "Missing 'kind' parameter"

ERROR WHEN KIND INVALID:
  "Unsupported kind '{}'. Supported: 'symbols', 'hierarchy', 'interfaces', 'inheritance', 'modules'"

SUPPORTED KINDS:
  1. symbols       -> detect_symbols() - Total symbols, categorization, visibility
  2. hierarchy     -> detect_hierarchy() - Hierarchy depth, root/leaf classes
  3. interfaces    -> detect_interfaces() - Interface count, fat interfaces (>10 methods)
  4. inheritance   -> detect_inheritance() - Inheritance depth chains
  5. modules       -> detect_modules() - Module count, god modules (>50 items), orphaned items

DOCUMENTATION: /workspace/docs/tools/analysis.md (lines 435-535)
STATUS: Well documented, up-to-date


TOOL 2: analyze.dependencies
============================
Handler: /workspace/crates/mill-handlers/src/handlers/tools/analysis/dependencies.rs (lines 1167-1356)

REQUIRED PARAMETERS:
  - kind (string): One of: "imports", "graph", "circular", "coupling", "cohesion", "depth"

OPTIONAL PARAMETERS:
  - scope (object): Analysis scope - handled by shared engine
  - options (object): Additional configuration

ERROR WHEN MISSING KIND:
  "Missing 'kind' parameter"

ERROR WHEN KIND INVALID:
  "Unsupported kind '{}'. Supported: 'imports', 'graph', 'circular', 'coupling', 'cohesion', 'depth'"

SUPPORTED KINDS:
  1. imports       -> detect_imports() - Import categorization (external, internal, relative)
  2. graph         -> detect_graph() - Dependency graph, fan-in/fan-out metrics
  3. circular      -> find_circular_dependencies() - Workspace-wide cycle detection (with feature flag)
                      OR detect_circular() - File-level detection (MVP fallback)
  4. coupling      -> detect_coupling() - Afferent/efferent coupling, instability metric
  5. cohesion      -> detect_cohesion() - LCOM score, module cohesion
  6. depth         -> detect_depth() - Max dependency depth, dependency chain

SPECIAL NOTES:
  - "circular" kind can run in two modes:
    * With feature: Workspace-wide analysis using DependencyGraphBuilder (lines 1213-1311)
    * Without feature: File-level detection via detect_circular() (lines 1303-1310)
  - Generates actionable suggestions for breaking cycles

DOCUMENTATION: /workspace/docs/tools/analysis.md (lines 313-432)
STATUS: Good, but needs clarification about feature flag requirement


TOOL 3: rename
==============
Handler: /workspace/crates/mill-handlers/src/handlers/rename_handler/mod.rs (lines 28-277)

TWO MODES: Single target mode OR Batch mode

SINGLE TARGET MODE (existing API):
REQUIRED:
  - target (object) with:
    * kind (string): "symbol", "file", or "directory"
    * path (string): File/directory path or file for symbol
  - new_name (string): New name or path

BATCH MODE (new API):
REQUIRED:
  - targets (array) with objects containing:
    * kind (string): "symbol", "file", or "directory"
    * path (string): Path per target
    * new_name (string): New name per target (REQUIRED in batch mode)

OPTIONAL PARAMETERS (both modes):
  - options (object) containing:
    * dryRun (boolean, default: true) - Preview mode vs execution
    * scope (string, default: "standard") - What to update: "code", "standard", "comments", "everything", or "custom"
    * custom_scope (RenameScope, optional) - Fine-grained control when scope="custom"
    * consolidate (boolean, optional) - Auto-detect or force Rust crate consolidation

VALIDATION ERRORS:
  1. Missing arguments: "Missing arguments for rename"
  2. Invalid JSON: "Invalid rename parameters: {error}"
  3. Missing new_name (single): "new_name is required for single target mode"
  4. Both modes: "Cannot specify both 'target' and 'targets'..."
  5. Neither mode: "Must specify either 'target' (for single rename) or 'targets' (for batch)."
  6. Bad kind: "Unsupported rename kind: {}. Must be one of: symbol, file, directory"
  7. Missing new_name (batch): "Target {} (path: {}) missing new_name field (required for batch mode)"
  8. Conflicts: "Batch rename has naming conflicts: {}"

RETURN VALUES:
  Preview mode (dryRun: true):  RenamePlan with edits, summary, warnings, metadata, checksums
  Execution mode (dryRun: false): ExecutionResult with applied/created/deleted files

DOCUMENTATION: /workspace/docs/tools/refactoring.md (lines 38-180)
STATUS: Excellent, comprehensive


TOOL 4: Circular Dependency Detection
======================================
PRIMARY ACCESS: analyze.dependencies with kind="circular"
LOCATION: /workspace/crates/mill-handlers/src/handlers/tools/analysis/dependencies.rs

EXISTS: YES - Two implementations:
  1. analyze.dependencies handler with kind="circular" (primary)
  2. Dedicated handler: circular_dependencies.rs (workspace-wide)

PARAMETER:
  - kind (string): Must be "circular"
  - scope (object): File, directory, or workspace scope

TWO MODES:
  File-Level (MVP):
    - Location: Lines 316-393 in dependencies.rs
    - Detects self-referential imports only
    - Limited to obvious cycles

  Workspace-Level (with analysis-circular-deps feature):
    - Location: Lines 1213-1311 in dependencies.rs
    - Uses DependencyGraphBuilder for full graph
    - Detects multi-module cycles with import chains
    - Returns 4 types of suggestions:
      1. Extract Interface (2-module cycles)
      2. Dependency Injection
      3. Extract Shared Module (multi-module cycles)
      4. Merge Modules (small 2-module cycles)

RETURNS:
  Array of cycle findings with:
  - cycle_length: Number of modules in cycle
  - cycle_path: Array of module names in cycle
  - import_chain: Detailed import path between modules
  - suggestions: Actionable refactoring recommendations
  - severity: High (architectural smell)

DOCUMENTATION: /workspace/docs/tools/analysis.md
STATUS: Documented as kind, but feature flag requirements not detailed


KEY PATTERNS
============

All tools follow consistent validation:
  1. Check for required parameter
  2. Validate parameter value against allowed set
  3. Dispatch to appropriate handler function
  4. Return ServerError::InvalidRequest() with clear message

All analysis tools use shared ScopeParam:
  - scope_type (string): "file", "directory", "workspace", "symbol"
  - path (string): Target path
  - include/exclude (array): Pattern matching (for directory/workspace scopes)

All refactoring tools support dryRun pattern:
  - Default (true): Safe preview mode
  - Explicit false: Execute with validation and rollback


ABSOLUTE FILE PATHS
===================
/workspace/crates/mill-handlers/src/handlers/tools/analysis/structure.rs
/workspace/crates/mill-handlers/src/handlers/tools/analysis/dependencies.rs
/workspace/crates/mill-handlers/src/handlers/tools/analysis/circular_dependencies.rs
/workspace/crates/mill-handlers/src/handlers/tools/analysis/engine.rs
/workspace/crates/mill-handlers/src/handlers/rename_handler/mod.rs
/workspace/docs/tools/analysis.md
/workspace/docs/tools/refactoring.md


RECOMMENDATIONS FOR DOCUMENTATION IMPROVEMENTS
==============================================

1. Circular dependencies feature flag clarity
   - Document analysis-circular-deps feature requirement
   - Explain file-level vs workspace-level detection
   - Clarify auto-detection logic

2. Scope parameter documentation
   - Create separate docs for shared ScopeParam structure
   - Document all scope types and their behavior
   - Include examples for each scope type

3. Batch rename deduplication
   - Document dedupe_document_changes() method behavior
   - Explain how multiple targets modifying same file are merged
   - Show examples of merged edits

4. Parameter validation reference
   - Create guide for tool authors
   - Document error message patterns
   - Include validation flow diagrams


Generated: 2025-10-28
