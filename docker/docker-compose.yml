version: '3.8'

services:
  codebuddy:
    build:
      context: ..
      dockerfile: docker/Dockerfile
      target: development
    container_name: codebuddy-dev
    working_dir: /app/rust
    ports:
      - "3000:3000"  # WebSocket server
      - "4000:4000"  # Admin/health endpoints
    environment:
      - RUST_LOG=debug
      - CODEBUDDY__SERVER__PORT=3000
      - CODEBUDDY__SERVER__HOST=0.0.0.0
      - CODEBUDDY__LOGGING__LEVEL=debug
      - CODEBUDDY__LOGGING__FORMAT=pretty
    volumes:
      # Mount host source code for hot-reloading
      - ../rust:/app/rust
      # Mount local cargo registry to cache dependencies
      - cargo-registry:/usr/local/cargo/registry
      # Mount target directory to cache builds
      - rust-target:/app/rust/target
    restart: unless-stopped
    networks:
      - codebuddy-net

volumes:
  cargo-registry:
  rust-target:

networks:
  codebuddy-net:
    driver: bridge
